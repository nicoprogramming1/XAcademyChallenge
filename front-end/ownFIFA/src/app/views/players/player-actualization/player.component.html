<div class="container my-4">
  <!-- muestra el loading-spinner si loading: true -->
  <app-loading-spinner [loading]="loading()" />

    <app-title-h1 [title]="title" />

  @if(player()) {

    <!-- muestra el loading-error si error: true -->
  <app-loading-error [error]="error()" />

    <div class="card shadow-lg player-card">
      <div class="row g-0">
        <div class="col-md-4 text-center p-4">
          <img [src]="player()?.playerFaceUrl" alt="{{ player()?.longName }} Foto"
               class="img-fluid rounded-circle player-image" />
        </div>
        <div class="col-md-8">
          <div class="card-body">

            <!-- alterna entre modo lectura y edicion -->
            @if(editMode) {
              <form [formGroup]="updateForm" (ngSubmit)="onSaveChanges()">
                <div><span class="obligatorios">Los campos marcados con (*) son obligatorios</span></div>
                <hr class="my-4">
        
                <div class="form-group mb-3">
                    <label for="longName">Nombre y apellido: *</label>
                    <input type="text-danger" class="form-control" id="longName" formControlName="longName">
                    <div class="text-danger">{{showNameErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="age">Edad: *</label>
                    <input type="number" class="form-control" id="age" formControlName="age">
                    <div class="text-danger">{{showAgeErrors()}}</div>
                </div>
                        
        
                <div formArrayName="playerPositions" class="mb-3">
                    <h5>Posiciones: *</h5>
                    @for(position of playerPositions; track position) {
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" [value]="position" (change)="onCheckboxChange($event)">
                        <label class="form-check-label">{{ position }}</label>
                      </div>
                    }
                    <div class="text-danger">{{showPlayerPositionsErrors()}}</div>
                </div>
                
                <div class="form-group mb-3">
                    <label for="clubName">Club:</label>
                    <input type="text-danger" class="form-control" id="clubName" formControlName="clubName">
                </div>
        
                <div class="form-group mb-3">
                    <label for="nationalityName">Nacionalidad:</label>
                    <input type="text-danger" class="form-control" id="nationalityName" formControlName="nationalityName">
                </div>
        
                <div class="form-group mb-3">
                    <label for="preferredFoot">Pie Preferido:</label>
                    <select class="form-select" id="preferredFoot" formControlName="preferredFoot">
                        @for(foot of preferredFoot; track foot) {
                        <option [value]="foot">{{ foot }}</option>
                        }
                    </select>
                </div>
        
                <div class="form-group mb-3">
                    <label for="bodyType">Tipo de cuerpo:</label>
                    <select class="form-select" id="bodyType" formControlName="bodyType">
                        @for(bodyType of bodyType; track bodyType) {
                        <option [value]="bodyType">{{ bodyType }}</option>
                        }
                    </select>
                </div>
        
                <div class="form-group mb-3">
                    <label for="heightCm">Altura (cm):</label>
                    <input type="number" class="form-control" id="heightCm" formControlName="heightCm">
                    <div class="text-danger">{{showHeightCmErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="weightKg">Peso (kg):</label>
                    <input type="number" class="form-control" id="weightKg" formControlName="weightKg">
                    <div class="text-danger">{{showWeightKgErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="potential">Potencial: *</label>
                    <input type="number" class="form-control" id="potential" formControlName="potential">
                    <div class="text-danger">{{showPotentialErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="overall">Nivel de skill general: *</label>
                    <input type="number" class="form-control" id="overall" formControlName="overall">
                    <div class="text-danger">{{showOverallErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="fifaUpdate">FIFA Update: *</label>
                    <select class="form-select" id="fifaUpdate" formControlName="fifaUpdate">
                        @for(fifaUpdate of fifaUpdate; track fifaUpdate) {
                        <option [value]="fifaUpdate">{{ fifaUpdate }}</option>
                        }
                    </select>
                    <div class="text-danger">{{showFifaUpdateErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="fifaVersion">FIFA Version: *</label>
                    <select class="form-select" id="fifaVersion" formControlName="fifaVersion" required>
                        @for(fifaVersion of fifaVersion; track fifaVersion) {
                        <option [value]="fifaVersion">{{ fifaVersion }}</option>
                        }
                    </select>
                    <div class="text-danger">{{showFifaVersionErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="passing">Pase: *</label>
                    <input type="number" class="form-control" id="passing" formControlName="passing">
                    <div class="text-danger">{{showPassingErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="dribbling">Regateo: *</label>
                    <input type="number" class="form-control" id="dribbling" formControlName="dribbling">
                    <div class="text-danger">{{showDribblingErrors()}}</div>
                </div>
        
                <div class="form-group mb-3">
                    <label for="shooting">Disparo: *</label>
                    <input type="number" class="form-control" id="shooting" formControlName="shooting">
                    <div class="text-danger">{{showShootingErrors()}}</div>
                </div>
        
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Actualizar</button>
                    <button type="button" (click)="cancelEdit()" class="btn btn-danger">Cancelar</button>
                    <button type="button" class="btn btn-secondary" (click)="resetForm()">Reestablecer</button>
                </div>
        
                <div>
                    @if(invalidForm) {
                        <span class="text-danger-danger">Hay campos obligatorios que deben ser completados!</span>
                    }
                </div>
            </form>

            } @else {

              <h4 class="card-title">{{ player()?.longName }}</h4>
              <p class="card-text"><span class="player-atribute">Edad:</span> {{ player()?.age }} años</p>
              <p class="card-text"><span class="player-atribute">Posición:</span> {{ player()?.playerPositions }}</p>
              <p class="card-text"><span class="player-atribute">Nacionalidad:</span> {{ player()?.nationalityName || 'No disponible' }}</p>
              <p class="card-text"><span class="player-atribute">Club:</span> {{ player()?.clubName || 'No disponible' }}</p>
              <p class="card-text"><span class="player-atribute">Pie Preferido:</span> {{ player()?.preferredFoot || 'No disponible' }}</p>
              <p class="card-text"><span class="player-atribute">Tipo de Cuerpo:</span> {{ player()?.bodyType || 'No disponible' }}</p>
              <p class="card-text"><span class="player-atribute">Altura:</span> {{ player()?.heightCm || 'No disponible' }} cm</p>
              <p class="card-text"><span class="player-atribute">Peso:</span> {{ player()?.weightKg || 'No disponible' }} kg</p>
              <p class="card-text"><span class="player-atribute">Versión FIFA:</span> {{ player()?.fifaVersion }}</p>
              <p class="card-text"><span class="player-atribute">Actualización FIFA:</span> {{ player()?.fifaUpdate }}</p>

              <!-- Gráfico de habilidades del jugador -->
              <div class="col-md-6 text-center">
                <canvas id="skillsRadarChart"></canvas>
              </div>

              <div class="optionbtns">
                <div class="mt-3">
                  <button type="button" (click)="toggleEdit()" class="btn btn-secondary me-2">Modificar</button>
                  <button type="button" (click)="confirmDelete()" class="btn btn-danger">Eliminar</button>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
